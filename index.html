<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§‘å­¸æ›¬å¤ªé™½</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- iOS Safari ä¸»ç•«é¢ icon -->
    <link rel="apple-touch-icon" href="uvicon180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="uvicon192.png">
    <meta name="theme-color" content="#42a5f5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç§‘å­¸æ›¬å¤ªé™½">
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #DAA520;
            --tertiary-color: #F8C300;
            --danger-color: #F44336;
            --background-light: #F7F9FC;
            --text-dark: #333;
            --text-light: #666;
            --border-color: #E0E0E0;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.12);
            --warning-bg: #FFF8E1;
            --warning-border: var(--tertiary-color);
            --warning-text: #8D6E1C;
            --danger-bg: #FFEBEE;
            --danger-border: var(--danger-color);
            --danger-text: #B71C1C;
            --error-text: #D32F2F;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            margin: 0;
            padding: 1.5em;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin: 1.5em auto;
            background: white;
            padding: 2.2em;
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-medium);
            animation: fadeIn 0.8s ease-out;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 1em;
            font-size: 2em;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.6em;
        }

        .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-top: -0.5em;
            margin-bottom: 1.5em;
            font-size: 0.95em;
        }

        .privacy-notice {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9em;
            margin-bottom: 1.5em;
            padding: 0.5em 1em;
            background-color: #f0f8ff;
            border-radius: 8px;
        }

        label {
            display: block;
            margin-top: 1.2em;
            margin-bottom: 0.5em;
            font-weight: bold;
            color: var(--text-dark);
            font-size: 1.05em;
        }

        input[type="date"],
        input[type="time"],
        input[type="number"],
        select {
            display: block;
            width: 100%;
            padding: 0.8em 1em;
            margin-bottom: 0.8em;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background-color: #fcfcfc;
        }

        input:focus,
        select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
            outline: none;
            background-color: #fff;
        }

        .flex-row {
            display: flex;
            gap: 0.8em;
            align-items: center;
        }

        .flex-row input,
        .flex-row select {
            flex-grow: 1;
            margin-bottom: 0;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 0.9em 1.5em;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin-top: 1.5em;
            width: 100%;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5em;
        }

        button:hover {
            background-color: #3a7bd5;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(74, 144, 226, 0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(74, 144, 226, 0.2);
        }

        button.inline {
            width: auto;
            margin-top: 0;
            padding: 0.8em 1.2em;
            font-size: 0.95em;
            flex-shrink: 0;
            background-color: #6c757d;
            box-shadow: none;
            min-width: 90px;
        }

        button.inline:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .error-message {
            color: var(--error-text);
            font-size: 0.9em;
            margin-top: -0.5em;
            margin-bottom: 0.8em;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .body-parts-card {
            margin-top: 1em;
            padding: 1.5em;
            border-radius: 10px;
            background-color: #EBF5FB;
            border-left: 6px solid var(--primary-color);
            box-shadow: 0 4px 15px var(--shadow-light);
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .body-parts-card[data-expanded="false"] {
            max-height: 50px;
        }

        .body-parts-card[data-expanded="true"] {
            max-height: 500px;
        }

        .body-parts-card[data-expanded="false"] .body-parts-content {
            display: none;
        }

        .body-parts-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .body-parts-card-header h3 {
            margin: 0;
            font-size: 1.2em;
            color: var(--primary-color);
        }

        .body-parts-card-header i {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .body-parts-card label {
            font-weight: normal;
            margin-top: 0.8em;
            margin-bottom: 0.3em;
            font-size: 1em;
            color: var(--text-light);
        }

        .body-parts-card select {
            margin-bottom: 0.8em;
        }

        #result {
            margin-top: 2em;
            padding: 2em;
            border-radius: 10px;
            background-color: #EBF5FB;
            border-left: 6px solid var(--primary-color);
            box-shadow: 0 4px 15px var(--shadow-light);
            color: var(--text-dark);
            font-size: 1.1em;
            line-height: 1.5;
            transition: all 0.4s ease;
        }

        .result-zenith-angle {
            font-size: 0.9em;
            color: var(--text-light);
            text-align: center;
            margin-bottom: 1em;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 1em;
        }

        .result-zenith-angle strong {
            font-weight: normal;
            color: var(--text-light);
        }

        .result-main-info {
            display: flex;
            flex-direction: column;
            gap: 0.4em;
            margin-top: 0.5em;
        }

        .result-item {
            display: flex;
            align-items: center;
            font-size: 1.2em;
            margin-bottom: 0em;
        }

        .result-item-icon {
            font-size: 1.4em;
            margin-right: 0.6em;
            color: var(--primary-color);
            flex-shrink: 0;
            width: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-item span.label {
            font-weight: bold;
            flex-shrink: 0;
            display: inline-flex;
            align-items: center;
        }

        .result-item span.value {
            font-weight: bold;
            margin-left: auto;
            font-size: 1.6em;
            text-align: right;
        }

        .vitd-time {
            color: var(--secondary-color);
            font-size: 1em;
        }

        .sunburn-time {
            color: var(--danger-color);
            font-size: 1em;
        }

        .sub-description {
            font-size: 0.85em;
            color: var(--text-light);
            margin-top: -8px;
            margin-left: 2.4em;
            text-align: left;
            line-height: 1.0;
        }

        .warning {
            background-color: var(--warning-bg);
            border-left-color: var(--warning-border);
            color: var(--warning-text);
        }

        .warning .result-item-icon {
            color: var(--warning-border);
        }

        .danger {
            background-color: var(--danger-bg);
            border-left-color: var(--danger-color);
            color: var(--danger-text);
        }

        .danger .result-item-icon {
            color: var(--danger-color);
        }

        .data-card, .info-card {
            margin-top: 1.5em;
            padding: 1.5em;
            border-radius: 10px;
            background-color: #EBF5FB;
            border-left: 6px solid var(--primary-color);
            box-shadow: 0 4px 15px var(--shadow-light);
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .data-card-header, .info-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .data-card-header h3 {
            margin: 0;
            font-size: 1.2em;
            color: var(--primary-color);
        }

        .info-card-header h3 {
            margin: 0;
            font-size: 1.2em;
            color: var(--primary-color);
        }

        .data-card-content, .info-card-content {
            margin-top: 1em;
            display: block;
        }

        .data-card[data-expanded="false"] {
            max-height: 50px;
        }

        .info-card[data-expanded="false"] {
            max-height: 50px;
        }

        .data-card[data-expanded="true"], .info-card[data-expanded="true"] {
            max-height: 1000px;
        }

        .data-card[data-expanded="false"] .data-card-content,
        .info-card[data-expanded="false"] .info-card-content {
            display: none;
        }

        .info-card-header i, .data-card-header i {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.85em;
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px var(--shadow-light);
        }

        .data-table th, .data-table td {
            width: 25%;
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: center;
        }

        .data-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            background-color: #f9f9f9;
        }

        .data-table tr:nth-child(even) td {
            background-color: #f2f2f2;
        }

        .data-table tr:hover td {
            background-color: #e6f0fa;
            transition: background-color 0.2s ease;
        }

        .table-note {
            font-size: 0.8em;
            color: var(--text-light);
            margin-bottom: 0.1em;
            text-align: left;
        }

        .info-card-content p {
            font-size: 0.95em;
            color: var(--text-dark);
            margin: 0;
        }

        @media (max-width: 600px) {
            body { padding: 0.8em; }
            .container { padding: 1.5em; margin: 0.8em auto; }
            h2 { font-size: 1.6em; }
            button { font-size: 1em; padding: 0.7em 1em; }
            button.inline { padding: 0.6em 0.8em; min-width: 80px; }
            .flex-row { flex-direction: column; align-items: stretch; gap: 0.5em; }
            .flex-row button.inline { width: 100%; margin-left: 0; }
            .body-parts-card { padding: 1em; }
            .body-parts-card[data-expanded="false"] { max-height: 45px; }
            .body-parts-card-header h3 { font-size: 1.1em; }
            .body-parts-card-header i { font-size: 0.8em; }
            #result { padding: 1.5em; font-size: 1em; line-height: 1.3; }
            .result-main-info { gap: 0.4em; }
            .result-item { font-size: 1.1em; margin-bottom: 0em; }
            .result-item-icon { font-size: 1.2em; width: 1.6em; margin-right: 0.5em; }
            .result-item span.label { font-size: 1em; }
            .result-item span.value { font-size: 1.4em; }
            .vitd-time, .sunburn-time { font-size: 0.9em; }
            .sub-description { font-size: 0.8em; margin-left: 2.1em; margin-top: -8px; line-height: 1.0; }
            .data-card, .info-card { padding: 1em; }
            .data-card-header h3 { font-size: 1.1em; }
            .info-card-header h3 { font-size: 1.1em; }
            .info-card-header i, .data-card-header i { font-size: 0.8em; }
            .data-card[data-expanded="false"] { max-height: 45px; }
            .info-card[data-expanded="false"] { max-height: 45px; }
            .data-table { font-size: 0.75em; }
            .data-table th, .data-table td { padding: 8px; }
            label span { font-size: 0.85em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ç§‘å­¸æ›¬å¤ªé™½</h2>
        <p class="subtitle">è³‡æ–™ä¾†è‡ª MDJJçŒ›çˆ¹å°‡è»ï¼Œæ¨è–¦YTå½±ç‰‡ <a href="https://youtu.be/K0wp58UI8sE?si=_XJlQx64gIJDBQZv" target="_blank">é»æˆ‘è§€çœ‹</a></p>
        <div class="privacy-notice">
            éš±ç§è²æ˜ï¼šæ‰€æœ‰è¼¸å…¥æ•¸æ“šåƒ…åœ¨æ‚¨çš„è¨­å‚™ä¸Šæœ¬åœ°è™•ç†ï¼Œä¸æœƒä¸Šå‚³æˆ–è¨˜éŒ„ä»»ä½•ä½ç½®è³‡è¨Šã€‚
        </div>

        <div class="info-card" id="infoCard" data-expanded="false">
            <div class="info-card-header" onclick="toggleInfoCard()">
                <h3>ä½¿ç”¨èªªæ˜</h3>
                <i class="fas fa-chevron-down" id="infoCardIcon"></i>
            </div>
            <div class="info-card-content">
                <p>
                    - å»ºè­°ä¸­åˆ 12 é»é™„è¿‘æ›¬å¤ªé™½ï¼ŒUVB(æ£’æ£’)ç›¸å°é«˜ï¼ŒUVA(çš®è†šè€åŒ–)ç›¸å°ä½ã€‚<br>
                    - åœ¨æ›¬å‚·ä¹‹å‰æ›¬å¤ ç¶­ç”Ÿç´  D å°±å°äº†ã€‚<br>
                    - è¼¸å…¥ç¶“ç·¯åº¦å¾Œï¼Œæœƒè‡ªå‹•æŠ“å– <a href="https://www.suncalc.org/" target="_blank">SunCalc</a>
                    è³‡æ–™ç®—å‡ºå¤©é ‚è§’ã€‚æ‚¨ä¹Ÿå¯ä»¥åˆ©ç”¨æ­¤ç¶²å€çŸ¥é“å„åœ°ç·¯åº¦ã€ç¶“åº¦<br>
                    - ã€Œå¤©é ‚è§’æ•¸æ“šè¡¨ã€ä¾†è‡ªYTå½±ç‰‡ï¼Œæ ¹æ“šäºæ´²äººè†šè‰²èª¿æ•´éï¼ˆ1.5 å€è€å—æ€§ï¼‰ã€‚<br>
					- ä¸åœ¨æ•¸æ“šè¡¨ä¸­çš„å¤©é ‚è§’ç”± AIç”¨ç·šæ€§æ’å€¼ä¼°ç®—ï¼Œå¯ä½œåƒè€ƒã€‚<br>

                </p>
            </div>
        </div>

        <label for="lat">ğŸ”¸è¼¸å…¥ç·¯åº¦ï¼ˆæ­£ç‚ºåŒ—ç·¯ï¼‰ï¼š</label>
        <input type="number" step="any" id="lat" placeholder="ä¾‹å¦‚ï¼š25.033" min="-90" max="90" required inputmode="decimal">
        <div id="lat-error" class="error-message"></div>

        <label for="lon">ğŸ”¸è¼¸å…¥ç¶“åº¦ï¼ˆæ­£ç‚ºæ±ç¶“ï¼‰ï¼š</label>
        <div class="flex-row">
            <input type="number" step="any" id="lon" placeholder="ä¾‹å¦‚ï¼š121.565" min="-180" max="180" required inputmode="decimal">
            <button class="inline" onclick="autoDetectLocation()">ğŸ“ è‡ªå‹•å®šä½</button>
        </div>
        <div id="lon-error" class="error-message"></div>

        <label for="timezone">ğŸ”¸é¸æ“‡æ™‚å€ï¼š<br>
            <span style="font-size: 0.8em; color: #666;">ï¼ˆè‡ªå‹•å®šä½ç”±ç¶“åº¦æ¨æ™‚å€ï¼Œå¤ä»¤æ™‚é–“å¯èƒ½UTC+1æˆ–+2ï¼‰</span>
        </label>
        <div class="flex-row">
<select id="timezone">
    <option value="-12">UTC-12:00ï¼ˆç„¡äººå€ï¼‰</option>
    <option value="-11">UTC-11:00ï¼ˆç¾å±¬è–©æ‘©äºï¼‰</option>
    <option value="-10">UTC-10:00ï¼ˆå¤å¨å¤·ï¼‰</option>
    <option value="-9">UTC-09:00ï¼ˆé˜¿æ‹‰æ–¯åŠ ï¼‰</option>
    <option value="-8">UTC-08:00ï¼ˆç¾è¥¿ï¼æ´›æ‰ç£¯ï¼‰</option>
    <option value="-7">UTC-07:00ï¼ˆç¾åœ‹ä¸¹ä½›ï¼å±±å€æ™‚é–“ï¼‰</option>
    <option value="-6">UTC-06:00ï¼ˆå¢¨è¥¿å“¥ï¼èŠåŠ å“¥ï¼‰</option>
    <option value="-5">UTC-05:00ï¼ˆç¾æ±ï¼ç´ç´„ï¼‰</option>
    <option value="-4">UTC-04:00ï¼ˆå¤§è¥¿æ´‹æ™‚é–“ï¼‰</option>
    <option value="-3">UTC-03:00ï¼ˆé˜¿æ ¹å»·ï¼å·´è¥¿æ±å²¸ï¼‰</option>
    <option value="-2">UTC-02:00ï¼ˆå—å¤§è¥¿æ´‹ï¼‰</option>
    <option value="-1">UTC-01:00ï¼ˆäºé€Ÿç¾¤å³¶ï¼‰</option>
    <option value="0">UTCÂ±00:00ï¼ˆå€«æ•¦ï¼æ ¼æ—å¨æ²»ï¼‰</option>
    <option value="1">UTC+01:00ï¼ˆå·´é»ï¼æŸæ—ï¼‰</option>
    <option value="2">UTC+02:00ï¼ˆå¸Œè‡˜ï¼å—éï¼‰</option>
    <option value="3">UTC+03:00ï¼ˆè«æ–¯ç§‘ï¼æ²™çƒåœ°ï¼‰</option>
    <option value="4">UTC+04:00ï¼ˆæœæ‹œï¼é«˜åŠ ç´¢ï¼‰</option>
    <option value="5">UTC+05:00ï¼ˆå·´åŸºæ–¯å¦ï¼‰</option>
    <option value="6">UTC+06:00ï¼ˆå­ŸåŠ æ‹‰ï¼‰</option>
    <option value="7">UTC+07:00ï¼ˆæ³°åœ‹ï¼è¶Šå—ï¼‰</option>
    <option value="8" selected>UTC+08:00ï¼ˆå°ç£ï¼‰</option>
    <option value="9">UTC+09:00ï¼ˆæ—¥æœ¬ï¼éŸ“åœ‹ï¼‰</option>
    <option value="10">UTC+10:00ï¼ˆé›ªæ¢¨ï¼å¸ƒé‡Œæ–¯æœ¬ï¼ˆæ¾³æ±ï¼‰ï¼‰</option>
    <option value="11">UTC+11:00ï¼ˆæ‰€ç¾…é–€ç¾¤å³¶ï¼‰</option>
    <option value="12">UTC+12:00ï¼ˆç´è¥¿è˜­ï¼‰</option>
    <option value="13">UTC+13:00ï¼ˆç´è¥¿è˜­æ¥µæ±éƒ¨ï¼‰</option>
    <option value="14">UTC+14:00ï¼ˆåŸºé‡Œå·´æ–¯ï¼‰</option>
</select>

        </div>
        <div id="timezone-error" class="error-message"></div>

        <label for="date">ğŸ”¸é¸æ“‡æ—¥æœŸï¼š</label>
        <div class="flex-row">
            <input type="date" id="date" required>
            <button class="inline" onclick="setToday()">ğŸ“… ä»Šå¤©</button>
        </div>
        <div id="date-error" class="error-message"></div>

        <label for="time">ğŸ”¸è¼¸å…¥æ™‚é–“ï¼š<br>
            <span style="font-size: 0.8em; color: #666;">ï¼ˆè«‹è¼¸å…¥ç•¶åœ°æ™‚é–“ï¼‰</span>
        </label>
        <div class="flex-row">
            <input type="time" id="time" required>
            <button class="inline" onclick="setNow()">â±ï¸ ç¾åœ¨</button>
        </div>
        <div id="time-error" class="error-message"></div>

        <label for="weather">ğŸ”¸é¸æ“‡å¤©æ°£æ¢ä»¶ï¼š<br>
            <span style="font-size: 0.8em; color: #666;">ï¼ˆå½±éŸ¿ç´«å¤–ç·šå¼·åº¦ï¼‰</span>
        </label>
        <select id="weather">
            <option value="sunny" selected>æ™´å¤©ï¼ˆé›²é‡ä½”å¤©ç©º20%ä»¥ä¸‹ï¼Œé™½å…‰ç›´å°„ï¼Œå½±å­æ¸…æ™°ï¼‰</option>
            <option value="partly_cloudy">å¤šé›²ï¼ˆé›²é‡50%å·¦å³ï¼Œèƒ½çœ‹åˆ°å¤ªé™½è¼ªå»“ï¼Œå½±å­æ¨¡ç³Šï¼‰</option>
            <option value="cloudy">é™°å¤©/é™°é›¨å¤©ï¼ˆé›²é‡80%ä»¥ä¸Šï¼Œå¹¾ä¹çœ‹ä¸åˆ°å¤ªé™½ï¼Œç„¡å½±å­ï¼‰</option>
        </select>
        <div id="weather-error" class="error-message"></div>

        <label for="quickOutfit">ğŸ”¸å¿«é€Ÿç©¿è‘—é è¨­ï¼š</label>
        <select id="quickOutfit" onchange="applyQuickOutfit()">
            <option value="custom">âš™ï¸ è‡ªå®šç¾©</option>
            <option value="shorts_tshirt_slippers">ğŸ©³ çŸ­çŸ­æ‹– (45.5%ï¼‰</option>
            <option value="longsleeve_longpants_shoes">ğŸ‘– é•·é•·é‹ï¼ˆ10%ï¼‰</option>
        </select>

        <label style="margin-top: 2em;">ğŸ”¸é¸æ“‡ç©¿è‘—éƒ¨ä½èˆ‡è¦†è“‹æƒ…æ³ï¼š</label>
        <div class="body-parts-card" id="bodyPartsHeadNeckHands" data-expanded="false">
            <div class="body-parts-card-header" onclick="toggleBodyPartsCard('bodyPartsHeadNeckHands')">
                <h3>é ­éƒ¨ã€è„–å­ã€æ‰‹ç©¿è‘— <span style="font-size: 0.8em; color: var(--text-light);">(é è¨­ç„¡é®è“‹)</span></h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="body-parts-content">
                <label for="head">ğŸ”¹é ­éƒ¨ï¼š</label>
                <select id="head">
                    <option value="4" selected>ç„¡é®è“‹ï¼ˆ4%ï¼‰</option>
                    <option value="3">å®‰å…¨å¸½/æ¯›å¸½ï¼ˆ3%ï¼‰</option>
                    <option value="2">æ£’çƒå¸½ï¼ˆ2%ï¼‰</option>
                    <option value="1">ç‰›ä»”å¸½ï¼ˆ1%ï¼‰</option>
                </select>
                <label for="neck">ğŸ”¹è„–å­ï¼š</label>
                <select id="neck">
                    <option value="2" selected>ç„¡é®è“‹ï¼ˆ2%ï¼‰</option>
                    <option value="0">æœ‰é®è“‹ï¼ˆ0%ï¼‰</option>
                </select>
                <label for="hands">ğŸ”¹æ‰‹ï¼š</label>
                <select id="hands">
                    <option value="4" selected>ç„¡é®è“‹ï¼ˆ4%ï¼‰</option>
                    <option value="0">æœ‰é®è“‹ï¼ˆ0%ï¼‰</option>
                </select>
            </div>
        </div>
        <div class="body-parts-card" id="bodyPartsTorsoLegsFeet" data-expanded="true">
            <div class="body-parts-card-header" onclick="toggleBodyPartsCard('bodyPartsTorsoLegsFeet')">
                <h3>ä¸Šè¡£ã€ä¸‹èº«ã€è…³ç©¿è‘—</h3>
                <i class="fas fa-chevron-up"></i>
            </div>
            <div class="body-parts-content">
                <label for="torso">ğŸ”¹ä¸Šè¡£ï¼š</label>
                <select id="torso">
                    <option value="47">ç„¡é®è“‹ï¼ˆ47%ï¼‰</option>
                    <option value="42">æ¯”åŸºå°¼ä¸Šè¡£/é‹å‹•å…§è¡£ï¼ˆ42%ï¼‰</option>
                    <option value="18">åŠå˜ï¼ˆ18%ï¼‰</option>
                    <option value="10" selected>çŸ­è¢–ï¼ˆ10%ï¼‰</option>
                    <option value="3">ä¸ƒåˆ†è¢–ï¼ˆ3%ï¼‰</option>
                    <option value="0">é•·è¢–ï¼ˆ0%ï¼‰</option>
                </select>
                <label for="legs">ğŸ”¹ä¸‹èº«ï¼š</label>
                <select id="legs">
                    <option value="38">æ¯”åŸºå°¼æ³³è¤²ï¼ˆ38%ï¼‰</option>
                    <option value="24">çŸ­è¤²/çŸ­è£™ï¼ˆ24%ï¼‰</option>
                    <option value="8">åŠè†è¤²/è£™ï¼ˆ8%ï¼‰</option>
                    <option value="0" selected>é•·è¤²ï¼ˆ0%ï¼‰</option>
                </select>
                <label for="feet">ğŸ”¹è…³ï¼š</label>
                <select id="feet">
                    <option value="2">ç„¡é®è“‹ï¼ˆ2%ï¼‰</option>
                    <option value="1.5">æ¶¼é‹/æ‹–é‹ï¼ˆ1.5%ï¼‰</option>
                    <option value="0" selected>é‹ï¼ˆ0%ï¼‰</option>
                </select>
            </div>
        </div>

        <button onclick="calculateZenithAngle()"><i class="fas fa-calculator"></i> è¨ˆç®—çµæœ</button>

        <div id="result"></div>
        <div id="dataCard" class="data-card" data-expanded="false"></div>
    </div>

    <script>
        function saveSelections() {
            const selects = document.querySelectorAll('.body-parts-card select');
            selects.forEach(select => {
                localStorage.setItem(`bodyPart_${select.id}`, select.value);
            });
            const inputs = ['lat', 'lon', 'date', 'time', 'timezone', 'weather', 'quickOutfit'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element && element.value) {
                    localStorage.setItem(`saved_${id}`, element.value);
                }
            });
        }

        function loadSelections() {
            const selects = document.querySelectorAll('.body-parts-card select');
            selects.forEach(select => {
            const savedValue = localStorage.getItem(`bodyPart_${select.id}`);
                if (savedValue) select.value = savedValue;
            });
            const inputs = ['lat', 'lon', 'date', 'time', 'timezone', 'weather', 'quickOutfit'];
            inputs.forEach(id => {
                const savedValue = localStorage.getItem(`saved_${id}`);
                const element = document.getElementById(id);
                if (savedValue && element) element.value = savedValue;
            });
        }

        function setToday() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            saveSelections();
        }

        function setNow() {
            const now = new Date();
            const timeStr = now.toTimeString().slice(0, 5);
            document.getElementById('time').value = timeStr;
            saveSelections();
        }

        function autoDetectLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => {
                        const lat = pos.coords.latitude.toFixed(5);
                        const lon = pos.coords.longitude.toFixed(5);
                        document.getElementById('lat').value = lat;
                        document.getElementById('lon').value = lon;
                        const estimatedOffset = Math.round(lon / 15);
                        document.getElementById('timezone').value = estimatedOffset;
                        document.getElementById('timezone-error').innerText = `è‡ªå‹•æ¨ä¼°æ™‚å€ï¼šUTC${estimatedOffset >= 0 ? '+' : ''}${estimatedOffset}ï¼Œè«‹ç¢ºèªæ­£ç¢ºã€‚`;
                        document.getElementById('timezone-error').classList.add('show');
                        saveSelections();
                    },
                    err => {
                        document.getElementById('lon-error').innerText = 'ç„¡æ³•ç²å–ä½ç½®ï¼Œè«‹æª¢æŸ¥æ¬Šé™æˆ–æ‰‹å‹•è¼¸å…¥ç¶“ç·¯åº¦ã€‚';
                        document.getElementById('lon-error').classList.add('show');
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            } else {
                document.getElementById('lon-error').innerText = 'ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚';
                document.getElementById('lon-error').classList.add('show');
            }
        }

        function applyQuickOutfit() {
            const outfit = document.getElementById('quickOutfit').value;
            if (outfit === 'custom') return;
            const settings = {
                'shorts_tshirt_slippers': { head: '4', neck: '2', hands: '4', torso: '10', legs: '24', feet: '1.5' },
                'longsleeve_longpants_shoes': { head: '4', neck: '2', hands: '4', torso: '0', legs: '0', feet: '0' }
            };
            Object.entries(settings[outfit]).forEach(([part, value]) => {
                const element = document.getElementById(part);
                if (element) element.value = value;
            });
            const headNeckHandsCard = document.getElementById('bodyPartsHeadNeckHands');
            headNeckHandsCard.setAttribute('data-expanded', 'true');
            headNeckHandsCard.querySelector('i').className = 'fas fa-chevron-up';
            setTimeout(() => {
                headNeckHandsCard.setAttribute('data-expanded', 'false');
                headNeckHandsCard.querySelector('i').className = 'fas fa-chevron-down';
            }, 2000);
            saveSelections();
        }

        function toggleBodyPartsCard(cardId) {
            const card = document.getElementById(cardId);
            const icon = card.querySelector('.body-parts-card-header i');
            const isExpanded = card.getAttribute('data-expanded') === 'true';
            card.setAttribute('data-expanded', !isExpanded);
            icon.className = `fas fa-chevron-${isExpanded ? 'down' : 'up'}`;
            localStorage.setItem(`${cardId}Expanded`, !isExpanded);
        }

        function toggleDataCard() {
            const dataCard = document.getElementById('dataCard');
            const icon = document.getElementById('dataCardIcon');
            const isExpanded = dataCard.getAttribute('data-expanded') === 'true';
            dataCard.setAttribute('data-expanded', !isExpanded);
            icon.className = `fas fa-chevron-${isExpanded ? 'down' : 'up'}`;
            localStorage.setItem('dataCardExpanded', !isExpanded);
        }

        function toggleInfoCard() {
            const infoCard = document.getElementById('infoCard');
            const icon = document.getElementById('infoCardIcon');
            const isExpanded = infoCard.getAttribute('data-expanded') === 'true';
            infoCard.setAttribute('data-expanded', !isExpanded);
            icon.className = `fas fa-chevron-${isExpanded ? 'down' : 'up'}`;
            localStorage.setItem('infoCardExpanded', !isExpanded);
        }

        function validateInputs() {
            let isValid = true;
            const errors = {
                date: document.getElementById('date-error'),
                time: document.getElementById('time-error'),
                timezone: document.getElementById('timezone-error'),
                lat: document.getElementById('lat-error'),
                lon: document.getElementById('lon-error'),
                weather: document.getElementById('weather-error')
            };
            Object.values(errors).forEach(error => {
                error.innerText = '';
                error.classList.remove('show');
            });

            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const timezone = parseFloat(document.getElementById('timezone').value);
            const lat = parseFloat(document.getElementById('lat').value);
            const lon = parseFloat(document.getElementById('lon').value);
            const weather = document.getElementById('weather').value;

            if (!date) {
                errors.date.innerText = 'è«‹é¸æ“‡æ—¥æœŸã€‚';
                errors.date.classList.add('show');
                isValid = false;
            }
            if (!time) {
                errors.time.innerText = 'è«‹è¼¸å…¥æ™‚é–“ã€‚';
                errors.time.classList.add('show');
                isValid = false;
            }
            if (isNaN(timezone) || timezone < -12 || timezone > 14) {
                errors.timezone.innerText = 'è«‹é¸æ“‡æœ‰æ•ˆæ™‚å€ï¼ˆUTC-12 åˆ° UTC+14ï¼‰ã€‚';
                errors.timezone.classList.add('show');
                isValid = false;
            }
            if (isNaN(lat) || lat < -90 || lat > 90) {
                errors.lat.innerText = 'è«‹è¼¸å…¥æœ‰æ•ˆç·¯åº¦ï¼ˆ-90 åˆ° 90ï¼‰ã€‚';
                errors.lat.classList.add('show');
                isValid = false;
            }
            if (isNaN(lon) || lon < -180 || lon > 180) {
                errors.lon.innerText = 'è«‹è¼¸å…¥æœ‰æ•ˆç¶“åº¦ï¼ˆ-180 åˆ° 180ï¼‰ã€‚';
                errors.lon.classList.add('show');
                isValid = false;
            }
            if (!weather) {
                errors.weather.innerText = 'è«‹é¸æ“‡å¤©æ°£æ¢ä»¶ã€‚';
                errors.weather.classList.add('show');
                isValid = false;
            }
            return isValid;
        }

        function calculateZenithAngle() {
            try {
                if (!validateInputs()) {
                    document.getElementById('result').innerHTML = '';
                    document.getElementById('dataCard').innerHTML = '';
                    return;
                }

                const dateInput = document.getElementById('date').value;
                const timeInput = document.getElementById('time').value;
                const timezoneOffset = parseFloat(document.getElementById('timezone').value);
                const lat = parseFloat(document.getElementById('lat').value);
                const lon = parseFloat(document.getElementById('lon').value);
                const weather = document.getElementById('weather').value;

                const weatherFactors = {
                    sunny: { factor: 1.0, description: 'æ™´å¤©ï¼Œç´«å¤–ç·šç„¡è¡°æ¸›' },
                    partly_cloudy: { factor: 0.7, description: 'å¤šé›²ï¼Œç´«å¤–ç·šæ¸›å°‘ç´„ 30%' },
                    cloudy: { factor: 0.3, description: 'é™°å¤©/é™°é›¨å¤©ï¼Œç´«å¤–ç·šæ¸›å°‘ç´„ 70%' }
                };
                const cloudFactor = weatherFactors[weather].factor;
                const weatherDescription = weatherFactors[weather].description;

                const [year, month, day] = dateInput.split('-').map(Number);
                const [hours, minutes] = timeInput.split(':').map(Number);
                const utcHours = hours - timezoneOffset;
                const dateObj = new Date(Date.UTC(year, month - 1, day, utcHours, minutes, 0));
                const sunPos = SunCalc.getPosition(dateObj, lat, lon);
                const altitude = sunPos.altitude * 180 / Math.PI;
                const zenithAngle = 90 - altitude;
                const roundedZenith = Math.round(zenithAngle);

                const uvData = {
                    70: { sunburn100: 180, vitD10: 200 },
                    63: { sunburn100: 70, vitD10: 77 },
                    57: { sunburn100: 60, vitD10: 43 },
                    53: { sunburn100: 45, vitD10: 30 },
                    50: { sunburn100: 36, vitD10: 23 },
                    47: { sunburn100: 30, vitD10: 19 },
                    42: { sunburn100: 26, vitD10: 15 },
                    38: { sunburn100: 24, vitD10: 13 },
                    36: { sunburn100: 22, vitD10: 12 },
                    32: { sunburn100: 20, vitD10: 11 },
                    24: { sunburn100: 18, vitD10: 10 },
                    0: { sunburn100: 12, vitD10: 6.7 }
                };

                const keys = Object.keys(uvData).map(Number).sort((a, b) => a - b);
                let lowerKey = keys.find(k => k <= zenithAngle) || keys[0];
                let upperKey = keys.find(k => k > zenithAngle) || keys[keys.length - 1];
                let data;
                if (lowerKey === upperKey || zenithAngle === lowerKey) {
                    data = uvData[lowerKey];
                } else {
                    const fraction = (zenithAngle - lowerKey) / (upperKey - lowerKey);
                    data = {
                        sunburn100: uvData[lowerKey].sunburn100 + fraction * (uvData[upperKey].sunburn100 - uvData[lowerKey].sunburn100),
                        vitD10: uvData[lowerKey].vitD10 + fraction * (uvData[upperKey].vitD10 - uvData[lowerKey].vitD10)
                    };
                }

                const totalBSA = ['head', 'neck', 'hands', 'torso', 'legs', 'feet']
                    .map(id => parseFloat(document.getElementById(id).value))
                    .reduce((a, b) => a + b, 0);

                let vitDTime = totalBSA <= 0 ? null : data.vitD10 * (10 / totalBSA) * 1.5 / cloudFactor;
                let displayMinutesFor4000 = totalBSA <= 0 ? 'ç„¡æ³•è¨ˆç®—ï¼ˆç„¡æ›éœ²é¢ç©ï¼‰' : Math.round(vitDTime * 4);
                let sunburnTime = data.sunburn100 * 1.5 / cloudFactor;

                const dataCardHTML = `
                    <div class="data-card-header" onclick="toggleDataCard()">
                        <h3>å¤©é ‚è§’æ•¸æ“šè¡¨</h3>
                        <i class="fas fa-chevron-down" id="dataCardIcon"></i>
                    </div>
                    <div class="data-card-content">
                        <div class="table-note">äºæ´²äºº1.5å€è€å—æ€§ / å–®ä½åˆ†é˜ / åŸºæ–¼${weatherDescription}</div>
                        <table class="data-table">
                            <tr>
                                <th>å¤©é ‚è§’</th>
                                <th>æ›¬å‚·æ™‚é–“</th>
                                <th>ç¶­ä»–å‘½D 1000 IU (10%)</th>
                                <th>ç¶­ä»–å‘½D 4000 IU (10%)</th>
                            </tr>
                            ${Object.keys(uvData).sort((a, b) => b - a).map(key => `
                                <tr>
                                    <td>${key}Â°</td>
                                    <td>${Math.round(uvData[key].sunburn100 * 1.5 / cloudFactor)}</td>
                                    <td>${Number((uvData[key].vitD10 * 1.5 / cloudFactor).toFixed(1))}</td>
                                    <td>${Number((uvData[key].vitD10 * 1.5 * 4 / cloudFactor).toFixed(1))}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                `;

                let resultHTML;
                let resultClass = '';
                if (zenithAngle >= 90) {
                    resultClass = '';
                    resultHTML = `
                        <div class="result-zenith-angle">
                            <strong>å¤ªé™½é«˜åº¦è§’ï¼š</strong> ${altitude.toFixed(1)}Â° Â· 
                            <strong>å¤©é ‚è§’ï¼š</strong> ç´„ ${roundedZenith}Â°
                        </div>
                        <p style="text-align: center; color: #46A3FF">${weatherDescription}
                        <div class="result-main-info">
                            <div class="result-item">
                                <span class="result-item-icon"><i class="fas fa-person"></i></span>
                                <span class="label">æ›éœ²é¢ç©ï¼š</span>
                                <span class="value">${totalBSA.toFixed(1)}%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-item-icon"><i class="fas fa-sun"></i></span>
                                <span class="label">å»ºè­°æ™‚é–“ï¼š</span>
                                <span class="value vitd-time">æ˜æ—¥è«‹æ—©</span>
                            </div>
                            <div class="sub-description">ï¼ˆå¤ªé™½å°šæœªå‡èµ·ï¼Œç„¡æ³•åˆæˆç¶­ä»–å‘½ Dï¼‰</div>
                            <div class="result-item">
                                <span class="result-item-icon"><i class="fas fa-fire"></i></span>
                                <span class="label">æ›¬å‚·æ™‚é–“ï¼š</span>
                                <span class="value sunburn-time">å¤©é»‘æ²’äº‹</span>
                            </div>
                            <div class="sub-description">ï¼ˆå¤ªé™½åœ¨åœ°å¹³ç·šä»¥ä¸‹ï¼Œç„¡æ›¬å‚·é¢¨éšªï¼‰</div>
                        </div>
                    `;
                } else {
                    if (sunburnTime <= 30) {
                        resultClass = 'danger';
                    } else if (sunburnTime <= 60) {
                        resultClass = 'warning';
                    }
                    resultHTML = `
                        <div class="result-zenith-angle">
                            <strong>å¤ªé™½é«˜åº¦è§’ï¼š</strong> ${altitude.toFixed(1)}Â° Â· 
                            <strong>å¤©é ‚è§’ï¼š</strong> ç´„ ${roundedZenith}Â°
                        </div>
                        <p style="text-align: center; color: #46A3FF">${weatherDescription}
                        <div class="result-main-info">
                            <div class="result-item">
                                <span class="result-item-icon"><i class="fas fa-person"></i></span>
                                <span class="label">æ›éœ²é¢ç©ï¼š</span>
                                <span class="value">${totalBSA.toFixed(1)}%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-item-icon"><i class="fas fa-sun"></i></span>
                                <span class="label">å»ºè­°æ›æ›¬æ™‚é–“ï¼š</span>
                                <span class="value vitd-time">${displayMinutesFor4000} åˆ†é˜</span>
                            </div>
                            <div class="sub-description">ï¼ˆå¯å¸æ”¶ç´„ 4000 IU ç¶­ä»–å‘½ Dï¼‰</div>
                            <div class="result-item">
                                <span class="result-item-icon"><i class="fas fa-fire"></i></span>
                                <span class="label">æ›¬å‚·æ™‚é–“ï¼š</span>
                                <span class="value sunburn-time">${Math.round(sunburnTime)} åˆ†é˜</span>
                            </div>
                            <div class="sub-description">ï¼ˆæ›æ›¬éƒ¨ä½å¯èƒ½é–‹å§‹æ›¬å‚·ï¼‰</div>
                        </div>
                    `;
                }

                document.getElementById('result').className = `result ${resultClass}`;
                document.getElementById('result').innerHTML = resultHTML;
                document.getElementById('dataCard').innerHTML = dataCardHTML;
                document.getElementById('dataCard').setAttribute('data-expanded', 'false');
                document.getElementById('dataCardIcon').className = 'fas fa-chevron-down';
            } catch (error) {
                console.error('Error in calculateZenithAngle:', error);
                document.getElementById('result').innerHTML = '<div class="error-message show">è¨ˆç®—éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è¼¸å…¥æˆ–è³‡æ–™ã€‚';
                document.getElementById('dataCard').innerHTML = '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSelections();
            if (!document.getElementById('date').value) setToday();
            if (!document.getElementById('time').value) setNow();
            const userTimezoneOffset = -(new Date().getTimezoneOffset() / 60);
            document.getElementById('timezone').value = userTimezoneOffset;
            applyQuickOutfit();

            const infoCard = document.getElementById('infoCard');
            const infoCardIcon = document.getElementById('infoCardIcon');
            const savedInfoCardState = localStorage.getItem('infoCardExpanded');
            if (savedInfoCardState === null) {
                infoCard.setAttribute('data-expanded', 'false');
                infoCardIcon.className = 'fas fa-chevron-down';
            } else {
                infoCard.setAttribute('data-expanded', savedInfoCardState);
                infoCardIcon.className = `fas fa-chevron-${savedInfoCardState === 'true' ? 'up' : 'down'}`;
            }

            const dataCard = document.getElementById('dataCard');
            const savedDataCardState = localStorage.getItem('dataCardExpanded');
            if (savedDataCardState === null) {
                dataCard.setAttribute('data-expanded', 'false');
                if (document.getElementById('dataCardIcon')) {
                    document.getElementById('dataCardIcon').className = 'fas fa-chevron-down';
                }
            } else {
                dataCard.setAttribute('data-expanded', savedDataCardState);
                if (document.getElementById('dataCardIcon')) {
                    document.getElementById('dataCardIcon').className = `fas fa-chevron-${savedDataCardState === 'true' ? 'up' : 'down'}`;
                }
            }

            const headNeckHandsCard = document.getElementById('bodyPartsHeadNeckHands');
            const torsoLegsFeetCard = document.getElementById('bodyPartsTorsoLegsFeet');
            const savedHeadNeckHandsState = localStorage.getItem('bodyPartsHeadNeckHandsExpanded');
            const savedTorsoLegsFeetState = localStorage.getItem('bodyPartsTorsoLegsFeetExpanded');
            headNeckHandsCard.setAttribute('data-expanded', savedHeadNeckHandsState || 'false');
            headNeckHandsCard.querySelector('i').className = `fas fa-chevron-${savedHeadNeckHandsState === 'true' ? 'up' : 'down'}`;
            torsoLegsFeetCard.setAttribute('data-expanded', savedTorsoLegsFeetState || 'true');
            torsoLegsFeetCard.querySelector('i').className = `fas fa-chevron-${savedTorsoLegsFeetState === 'false' ? 'down' : 'up'}`;

            const inputs = ['lat', 'lon', 'date', 'time', 'weather', 'quickOutfit'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveSelections);
                }
            });

            document.querySelectorAll('.body-parts-card select').forEach(select => {
                select.addEventListener('change', saveSelections);
            });
        });
    </script>
</body>
</html>